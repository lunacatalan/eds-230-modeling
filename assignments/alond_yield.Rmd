---
title: "Almond Yield Assignment"
output:
  slidy_presentation:
    highlight: pygments
  html_document: default
  pdf_document: default
  ioslides_presentation:
    highlight: pygments
  beamer_presentation:
    highlight: pygments
---

Submit 
- .R function 
- .RMD
- .html

Your goal is to implement a simple model of almond yield anomaly response to climate
- Inputs: daily times series of minimum, maximum daily temperatures and precipitation
- Outputs: maximum, minimum and mean yield anomoly for a input time series
The Lobell et al. 2006 paper will be the source for the transfer function that you will use in your model; specifically look at the equations in table 2.

Grading 
- a clear diagram that corresponds with your R function (10 pts) 
- inputs and output and parameters shown on the diagram (10 pts)
- correct function implementation (*.R file) (10 pts)
- application of the function to clim.txt (in Rmarkdown file) (10 pts)
- coding practices (clear documentation, informative variables names) (10 pts)

# Draw the Model

# Implement Model in R
- create an R file that has your function definition

```{r}
library(tidyverse)

clim <- read.delim(here::here("assignments", "clim.txt"),
                   header = TRUE,
                   sep = "")

View(clim)

# EQUATION 

almond_func <- function(df){

  yields <- data.frame()
 
  for(date in 1:nrow(df)) {
    
    T_min = df$tmin_c[date]
    T_max = df$tmax_c[date]
    P = df$precip[date]
    
    
    Y_min = (-0.015*T_min) - (0.0046*(T_min**2)) - (0.07*P) + (0.0043*(P^2)) + 0.28
    Y_max = (-0.015*T_max) - (0.0046*(T_max^2)) - (0.07*P) + (0.0043*(P^2)) + 0.28
    Y_mean = mean(Y_min, Y_max)
   
    calculations <- data.frame(Y_min = Y_min,
                               Y_max = Y_max,
                               Y_mean = Y_mean)
     
   yields <-  rbind(yields, calculations)
  }
  
 #results_df <- data.frame()

  #results_df["Y_min"] <- Y_min
  #results_df["Y_max"] <- Y_max

  return(yields)
}

test <- almond_func(clim)
    #t, solar=sierraczosolar, clr="green", eunit="W", g=FALSE, etype="direct", 
                              # substitutes in the efficiency mapped at the beginning of the code
                             # eff=.x 
 test                             #)

```

```{r}

subset <- clim %>% 
    filter(D >= "1988-12-01" & D <= "1988-12-20")

yields <- function(df, start_date, end_date){

  # subset basedon defined date
  subset <- df %>% 
    filter(df$D >= start_date & df&D <= end_date)
  
  # we want this to be dataframe with min, max, and mean almond yields
  yields <- almond_func(subset)
  
  # returns dataframe
  return(yields)
  
}


```


# Run the Model
- apply the function to the test climate data (clim.txt)

# Check Work

- the maximum almond yield anomaly should be approximately 1920 ton/acre 
- the lowest almond yield anomaly should be approximately -0.027 ton/acre 
- the mean almond yield anomaly should be approximately 182 ton/acre